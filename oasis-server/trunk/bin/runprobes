#!/usr/bin/python

#####################################################################
#                                                                   #
#  this is just a temporary solution                                #
#                                                                   #
#  the functionalities of this script will be included              #
#  in /usr/bin/oasis                                                #
#                                                                   #
#####################################################################

import getopt
import os
import sys
import time

from oasispackage.oasisAPI import oasisCLI, FlagFile


# FIXME
# if the daemon is running, 
# how to prevent to run probes and publish itself
# in parallel ???

def main():

    conffile = '/etc/oasis/oasis.conf'

    oasis = oasisCLI(conffile)

    projectname = oasis.project.projectname

    flag = FlagFile(projectname)
    flag.create()

    oasis.project._checkflagfile()  # temporary solution ?

    rc = oasis.project.runprobes()
    # FIXME
    # to make this work I had to modify runprobes()
    # If user is root, calls the probes with sudo
    # If user is regular user (the one running this script), calls the probes normally

    return rc


if __name__ == '__main__':
    rc = main()
    sys.exit(rc)
